<template>
  <v-menu rounded="0" left offset-y light :close-on-content-click="false">
    <template v-slot:activator="{ on: menu }">
      <v-badge :value="!allFlowing" dot overlap color="error">
        <v-btn v-on="{ ...menu }" elevation="0" x-small height="25px" class="px-0">
          <svg width="23" version="1.1" viewBox="0 0 48 48" xmlns="http://www.w3.org/2000/svg">
            <path
                v-if="flowing"
                d="M 21.927734 7.1464844 A 1.5684289 1.5684289 0 0 0 20.861328 7.6972656 L 16.910156 12.376953 L 15.179688 10.738281 A 1.5684289 1.5684289 0 0 0 12.962891 10.796875 A 1.5684289 1.5684289 0 0 0 13.023438 13.015625 L 15.958984 15.796875 A 1.5685857 1.5685857 0 0 0 18.236328 15.669922 L 23.257812 9.7207031 A 1.5684289 1.5684289 0 0 0 23.072266 7.5097656 A 1.5684289 1.5684289 0 0 0 21.927734 7.1464844 z M 32.267578 13.542969 C 31.232079 13.508815 30.190961 13.922271 29.449219 14.763672 L 29.363281 14.861328 C 28.044628 16.357152 28.18777 18.622753 29.683594 19.941406 L 30.439453 20.607422 L 7.8574219 20.607422 C 5.9718281 20.607422 4.453125 22.124172 4.453125 24.009766 L 4.453125 24.271484 C 4.453125 26.157078 5.9718281 27.675781 7.8574219 27.675781 L 30.478516 27.675781 L 29.683594 28.376953 C 28.18777 29.695606 28.044628 31.961208 29.363281 33.457031 L 29.449219 33.556641 C 30.767872 35.052464 33.033473 35.193653 34.529297 33.875 L 42.259766 27.0625 C 43.123894 26.300722 43.53257 25.223069 43.472656 24.160156 C 43.53272 23.097091 43.124022 22.019704 42.259766 21.257812 L 34.529297 14.443359 C 33.874874 13.866449 33.072967 13.569533 32.267578 13.542969 z "
                fill="grey"
              />
              <path v-else d="m 20.25,13.089844 -6.435547,7.517578 H 7.5957031 c -1.7409523,0 -3.1195012,1.701626 -3.1195012,3.442578 -0.064887,2.049839 1.5851023,3.513035 3.1195012,3.559375 h 7.7578129 c 0.956328,0 1.809314,-0.423979 2.384765,-1.09375 2.606206,-2.891073 5.167966,-5.976645 7.72461,-8.962891 1.257571,-1.653751 0.857541,-3.619345 -0.408646,-4.764807 C 23.285243,11.413604 21.194114,11.836248 20.25,13.089844 Z m 12.318359,7.632812 c -1.921214,0.08092 -3.05027,1.607359 -3.05027,3.628606 0,1.740953 1.309318,3.373347 3.05027,3.373347 h 7.759766 c 1.740952,0 3.144531,-1.8235 3.144531,-3.564453 0.06489,-2.049839 -1.610132,-3.39116 -3.144531,-3.4375 z" fill="grey" />
          </svg>
        </v-btn>
      </v-badge>
    </template>
    <v-card class="mx-auto" max-width="400">
      <v-list>
        <small style="color: grey">Data Flowing</small>
        <v-list-item style="min-height: 50px; height: 50px">
          <v-list-item-action class="mx-3 px-0">
            <v-switch v-model="flowing" label="Flow TaskBox Data" inset dense hide-details="true" @change="toggleFlowing()" />
          </v-list-item-action>
        </v-list-item>

        <v-list-item style="min-height: 40px; height: 40px">
          <v-btn block @click="toggleAllFlowing(true)" small>
            <v-list-item-icon>
              <svg width="23" version="1.1" viewBox="0 0 48 48" xmlns="http://www.w3.org/2000/svg">
                <path
                  d="M 21.927734 7.1464844 A 1.5684289 1.5684289 0 0 0 20.861328 7.6972656 L 16.910156 12.376953 L 15.179688 10.738281 A 1.5684289 1.5684289 0 0 0 12.962891 10.796875 A 1.5684289 1.5684289 0 0 0 13.023438 13.015625 L 15.958984 15.796875 A 1.5685857 1.5685857 0 0 0 18.236328 15.669922 L 23.257812 9.7207031 A 1.5684289 1.5684289 0 0 0 23.072266 7.5097656 A 1.5684289 1.5684289 0 0 0 21.927734 7.1464844 z M 32.267578 13.542969 C 31.232079 13.508815 30.190961 13.922271 29.449219 14.763672 L 29.363281 14.861328 C 28.044628 16.357152 28.18777 18.622753 29.683594 19.941406 L 30.439453 20.607422 L 7.8574219 20.607422 C 5.9718281 20.607422 4.453125 22.124172 4.453125 24.009766 L 4.453125 24.271484 C 4.453125 26.157078 5.9718281 27.675781 7.8574219 27.675781 L 30.478516 27.675781 L 29.683594 28.376953 C 28.18777 29.695606 28.044628 31.961208 29.363281 33.457031 L 29.449219 33.556641 C 30.767872 35.052464 33.033473 35.193653 34.529297 33.875 L 42.259766 27.0625 C 43.123894 26.300722 43.53257 25.223069 43.472656 24.160156 C 43.53272 23.097091 43.124022 22.019704 42.259766 21.257812 L 34.529297 14.443359 C 33.874874 13.866449 33.072967 13.569533 32.267578 13.542969 z "
                  fill="#0057ff"
                />
              </svg>
            </v-list-item-icon>
            <v-list-item-content style="overflow: visible">
              <v-badge :value="!allFlowing" offset-x="5" dot overlap color="error">
                <span>Flow All Tasks</span>
              </v-badge>
            </v-list-item-content>
          </v-btn>
        </v-list-item>
        <v-list-item style="min-height: 40px; height: 40px" class="mb-2">
          <v-btn block @click="toggleAllFlowing(false)" small>
            <v-list-item-icon>
              <svg width="25" version="1.1" viewBox="0 0 48 48" xmlns="http://www.w3.org/2000/svg">
                <path d="m 20.25,13.089844 -6.435547,7.517578 H 7.5957031 c -1.7409523,0 -3.1195012,1.701626 -3.1195012,3.442578 -0.064887,2.049839 1.5851023,3.513035 3.1195012,3.559375 h 7.7578129 c 0.956328,0 1.809314,-0.423979 2.384765,-1.09375 2.606206,-2.891073 5.167966,-5.976645 7.72461,-8.962891 1.257571,-1.653751 0.857541,-3.619345 -0.408646,-4.764807 C 23.285243,11.413604 21.194114,11.836248 20.25,13.089844 Z m 12.318359,7.632812 c -1.921214,0.08092 -3.05027,1.607359 -3.05027,3.628606 0,1.740953 1.309318,3.373347 3.05027,3.373347 h 7.759766 c 1.740952,0 3.144531,-1.8235 3.144531,-3.564453 0.06489,-2.049839 -1.610132,-3.39116 -3.144531,-3.4375 z" fill="grey" />
              </svg>
            </v-list-item-icon>
            <v-list-item-content v-text="'Unflow All Tasks'"></v-list-item-content>
          </v-btn>
        </v-list-item>
      </v-list>
    </v-card>
  </v-menu>
</template>

<script>
import { getStatusTypeByValue } from '../../enums/taskstate';
export default {
  name: 'FlowingMenu',
  props: { taskbox: {} },
  computed: {
    status(){
      if(!this.taskbox)return
      return getStatusTypeByValue(this.taskbox.data.task.status)
    },
    flowing: {
      get(){
        return this.taskbox.data.flowingData.flowing;
      },
      set(){

      }
    },
    allFlowing() {
      return true;
    },
  },
  methods: {
    toggleFlowing() {
      this.$store.commit('taskbox/toggleDataFlowing', this.taskbox);
    },
    toggleAllFlowing(value) {
      this.$store.commit('taskbox/toogleAllTasksFlowing', { taskbox: this.taskbox, value: value });
    },
  },
};
</script>
