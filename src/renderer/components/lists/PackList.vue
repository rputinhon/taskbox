<template>
  <v-sheet width="100%"  height="calc(100vh - 40px)" color="transparent">
    <v-card-title height="40px" class="text-subtitle-1" v-if="!searching">
      <v-list-item class="ma-0 pa-0" style="min-height: 30px; width: 100%">
        <v-list-item-icon class="pa-0 mr-1">
          <svg class="mx-1" style="pointer-events: none" width="23" height="23" version="1.1" viewBox="0 0 48 48" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
            <path :d="icon" fill="#0187f3" />
          </svg>
        </v-list-item-icon>
        <v-list-item-content class="text-left" style="min-width: 180px">
          <v-list-item-title> Packs </v-list-item-title>
          <v-list-item-subtitle>
            <v-tooltip bottom transition="none">
              <template v-slot:activator="{ on }">
                <v-list-item v-on="on" link class="ma-0 pa-0" style="min-height: 15px" @click="openFolder()">
                  <small v-on="on" style="font-size: 11px"> {{ folder }}</small>
                </v-list-item>
              </template>
              open folder
            </v-tooltip>
          </v-list-item-subtitle>
        </v-list-item-content>
        <v-list-item-action class="mx-0 px-0">
          <v-tooltip bottom transition="none">
            <template v-slot:activator="{ on }">
              <v-btn v-on="on" icon x-small fab  @click="updateList()">
                <svg style="pointer-events: none" width="20" height="20" version="1.1" viewBox="0 0 48 48" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
                  <path
                    d="m 28.140727,1.9592277 c -3.712435,2.1435384 -7.42487,4.2870767 -11.137305,6.4306152 3.712599,2.1430821 7.424944,4.2866031 11.137305,6.4300981 v -3.416329 c 3.85871,1.271454 6.94063,4.256307 8.315254,8.133354 1.522952,4.295395 0.728999,9.060692 -2.103747,12.630752 -1.100653,1.38662 -0.868828,3.402954 0.517798,4.503602 1.387027,1.100297 3.403417,0.86777 4.503599,-0.519348 4.200301,-5.293563 5.383573,-12.386901 3.125391,-18.755961 -2.258179,-6.36906 -7.645813,-11.1358729 -14.24254,-12.6012975 -0.03848,-0.00622 -0.07707,-0.011729 -0.115755,-0.016536 z M 9.612142,10.605212 c -4.8769639,5.256283 -6.4999034,12.76998 -4.2266155,19.570381 2.2732881,6.8004 8.0888365,11.82859 15.1463625,13.095325 0.06113,0.008 0.122479,0.01418 0.183968,0.0186 v 2.751254 c 3.712271,-2.143649 7.424796,-4.286861 11.137306,-6.430097 -3.712436,-2.143538 -7.424871,-4.287076 -11.137306,-6.430614 v 3.572907 c -4.326978,-1.1079 -7.819576,-4.329509 -9.250081,-8.608776 -1.5337477,-4.588111 -0.44303,-9.633235 2.847371,-13.179557 1.203571,-1.297811 1.12746,-3.325506 -0.170015,-4.529439 -1.400971,-1.1671185 -3.388026,-1.0259098 -4.53099,0.170016 z"
                    fill="grey"
                  />
                </svg>
              </v-btn>
            </template>
            refresh
          </v-tooltip>
        </v-list-item-action>
        <v-list-item-action class="mx-0 px-0">
          <v-tooltip bottom transition="none">
            <template v-slot:activator="{ on }">
              <v-btn v-on="on" icon x-small fab @click="searching = true">
                <svg style="pointer-events: none" width="26" version="1.1" viewBox="0 0 48 48" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
                  <path d=" m 22.121137,7.9380399 c -7.822717,0 -14.1953125,6.3725951 -14.1953125,14.1953121 0,7.822717 6.3725955,14.197266 14.1953125,14.197266 3.350703,0 6.433047,-1.173105 8.865234,-3.125 2.121511,2.137665 4.243856,4.274288 6.365235,6.412109 0.583525,0.58805 1.533022,0.593256 2.121094,0.0098 0.02338,-0.03229 0.04564,-0.06559 0.06641,-0.09961 0.03404,-0.02075 0.06735,-0.04301 0.09961,-0.06641 0.583525,-0.58805 0.580281,-1.537599 -0.0078,-2.121094 -2.136704,-2.124482 -4.276181,-4.245945 -6.416016,-6.367187 1.939424,-2.428166 3.103516,-5.501038 3.103516,-8.839844 0,-7.822717 -6.374549,-14.1953121 -14.197266,-14.1953121 z m 0,3.0000001 c 6.201398,0 11.197266,4.993914 11.197266,11.195312 0,6.201398 -4.995868,11.197266 -11.197266,11.197266 -6.201398,0 -11.195313,-4.995868 -11.195313,-11.197266 0,-6.201398 4.993915,-11.195312 11.195313,-11.195312 z" fill="grey" />
                </svg>
              </v-btn>
            </template>
            search
          </v-tooltip>
        </v-list-item-action>
      </v-list-item>
    </v-card-title>
    <v-card-title v-else style="height: 92px">
      <v-text-field v-model="search" autofocus rounded dense solo placeholder="search" hide-details="true">
        <template v-slot:append>
          <v-btn style="margin-right:-18px" color="primary" rounded x-small @click="(searching = false), (search = '')">close</v-btn>
        </template>
      </v-text-field>
    </v-card-title>

    <v-list class="px-4 py-0" v-for="(pack, t) in filteredList" :key="t" color="trasnparent">
      <pack-item :pack="pack" :folder="folder" />
    </v-list>
    <empty :text="' '" :extraClass="'mb-12 mr-5'" :icon="icon" v-if="isEmpty" />
  </v-sheet>
</template>

<script>
import { mapState } from 'vuex';
import { ipcRenderer } from 'electron';

import Empty from '../dialogs/Empty.vue';
import PackItem from './PackItem.vue';
import { eventBus } from '../../../main';

export default {
  name: 'PackList',
  props: { folder: String },
  components: {
    PackItem,
    Empty,
    // SortMenu,
  },
  data() {
    return {
      loading: false,
      searching: false,
      search: '',
      icon: 'm 20.716197,2.2600586 c -3.526603,0.021492 -7.47311,1.1898149 -9.949534,3.1139128 L 4.5179127,10.228541 c -1.4089796,1.09473 -2.1057563,2.251628 -2.1289846,3.300291 l -0.029196,-0.03455 0.018978,23.449 h 0.015571 c 0.053192,1.344937 1.2313929,2.495295 3.4696357,3.074981 l 16.8562022,4.365512 c 4.047856,1.048349 9.964956,-0.173255 13.266854,-2.738723 l 6.248263,-4.854572 c 1.390963,-1.080733 2.035822,-2.218697 2.083241,-3.252117 l 0.01656,-3.78e-4 0.03599,-23.375513 -0.0059,0.0068 C 44.364426,8.7838478 43.179494,7.5939874 40.889212,7.0008307 L 24.033033,2.6352462 C 23.021068,2.3731579 21.892219,2.2528935 20.716684,2.2600586 Z m 0.193677,2.0506373 c 0.917058,-0.00555 1.797445,0.087523 2.586898,0.2919748 l 6.107632,1.5786112 -1.458415,1.1270235 -3.255523,-0.9640045 c -1.927148,-0.5706317 -3.664461,-0.4019308 -3.895432,0.3781075 -0.230972,0.7800391 1.134209,1.8673581 3.061357,2.437991 L 25.28074,9.5229347 24.106026,10.430491 20.44904,9.3477506 c -1.927147,-0.5706332 -3.664948,-0.4019321 -3.895919,0.3781068 -0.230972,0.7800386 1.134696,1.8673586 3.061844,2.4379916 l 1.625327,0.481272 -1.065709,0.82337 -3.889106,-1.151842 c -1.927148,-0.570632 -3.664948,-0.401931 -3.895919,0.378108 -0.23097,0.780039 1.134696,1.867359 3.061844,2.437991 l 1.858421,0.550373 -2.182514,1.686641 -7.1091033,-1.855014 C 6.4596586,15.111102 5.5589983,14.353118 5.353447,13.449026 5.5063506,12.737294 6.0382511,11.980081 6.9685558,11.257267 L 13.146746,6.7389541 c 1.931907,-1.501022 5.011956,-2.4114922 7.763128,-2.4282582 z m 9.747098,2.1430959 8.123229,2.2958962 c 1.552758,0.4021451 2.454807,1.1553783 2.664755,2.055018 -0.149766,0.714892 -0.650524,1.514258 -1.614133,2.202465 l -6.148992,4.391303 c -2.719132,1.801921 -7.191733,2.954605 -10.349538,2.13677 l -7.152414,-1.892485 2.146017,-1.658904 3.420486,1.012667 c 1.927149,0.570632 3.664462,0.402417 3.895433,-0.377621 0.230972,-0.780039 -1.134695,-1.867359 -3.061844,-2.437992 l -1.388827,-0.411198 1.065221,-0.823369 3.65358,1.081281 c 1.927147,0.570633 3.664464,0.401932 3.895435,-0.378107 0.230971,-0.780039 -1.134699,-1.867359 -3.061847,-2.437992 l -1.621434,-0.479812 1.174712,-0.9080426 4.054559,1.2005046 c 1.927149,0.570632 3.664462,0.401931 3.895433,-0.378108 0.230975,-0.7800386 -1.13421,-1.867359 -3.061355,-2.4379915 L 29.16206,7.6090392 Z m 10.97534,8.4847932 0.06472,17.92726 c -0.125581,0.868963 -0.49417,1.618392 -1.633598,2.503687 l -6.134392,4.457 C 31.353164,41.827907 26.60545,42.72618 23.450058,41.899067 L 7.8542135,37.81093 C 6.3195172,37.412436 5.4219408,36.672059 5.1987013,35.786085 5.1873168,35.459065 5.1754862,35.132055 5.1641523,34.80505 l 0.064719,-17.408036 c 0.00162,-0.416163 0.8050291,0.321198 1.28031,0.444288 l 16.2109367,4.107115 c 4.047852,1.048346 9.964957,-0.173261 13.266855,-2.738725 z m -12.651277,8.741244 c -1.067757,0 -1.927034,0.859275 -1.927034,1.927035 V 38.88686 c 0,1.067757 0.859277,1.928009 1.927034,1.928009 1.067762,0 1.928007,-0.860252 1.928007,-1.928009 V 25.606864 c 0,-1.06776 -0.860245,-1.927035 -1.928007,-1.927035 z m -10.850276,0.88955 c -0.568143,0 -1.070531,0.114355 -1.507564,0.342584 -0.437033,0.223373 -0.835327,0.572796 -1.194664,1.048677 v -1.194664 h -2.607337 v 11.260986 h 2.607337 v -4.282786 c 0.359337,0.475881 0.757631,0.827749 1.194664,1.055975 0.437033,0.223375 0.939421,0.335289 1.507564,0.335289 1.005175,0 1.831085,-0.398294 2.476922,-1.194666 0.645836,-0.801226 0.968383,-1.830927 0.968383,-3.08861 0,-1.257683 -0.322547,-2.28445 -0.968383,-3.080822 -0.645837,-0.801226 -1.471747,-1.201963 -2.476922,-1.201963 z m -0.968384,1.893944 c 0.558431,0 0.983116,0.203789 1.274471,0.611689 0.296211,0.407898 0.444289,1.000206 0.444289,1.777152 0,0.77695 -0.148078,1.369745 -0.444289,1.777642 -0.291355,0.407898 -0.71604,0.611688 -1.274471,0.611688 -0.55843,0 -0.988488,-0.20379 -1.289556,-0.611688 -0.29621,-0.412754 -0.444288,-1.005549 -0.444288,-1.777642 0,-0.772089 0.148078,-1.361954 0.444288,-1.769854 0.301068,-0.412753 0.731126,-0.618987 1.289556,-0.618987 z',
    };
  },
  mounted() {
    this.updateList();
  },
  computed: {
    ...mapState({
      packList: (state) => state.taskbox.packList,
    }),
    isEmpty() {
      return this.packList.length == 0 ? true : false;
    },
    filteredList() {
      return this.packList.filter((t) => t.name.toLowerCase().includes(this.search));
    },
  },
  methods: {
    async updateList() {
      this.loading = true;
      eventBus.$emit('setWorking',true)
      await new Promise((res) => {
        this.$store.dispatch('taskbox/GET_PACK_LIST');
        setTimeout(res, 1000);
      });
      this.loading = false;
      eventBus.$emit('setWorking',false)
    },
    async openFolder() {
      ipcRenderer.send('app:openFolder', this.folder);
    },
  },
};
</script>
