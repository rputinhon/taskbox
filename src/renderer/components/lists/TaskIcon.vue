<template>
  <v-tooltip bottom transition="none">
    <template v-slot:activator="{ on }">
      <v-list-item-icon style="display:flex!important" v-on="on" class="mx-1 my-auto px-0"  :class="extraClass ? extraClass : ''"  @click="!mute?openContent():undefined">
        <svg  style="pointer-events: none" :height="size || 28" version="1.1" viewBox="0 0 48 48" xmlns="http://www.w3.org/2000/svg">
          <path class="multiply" :d="getIcon" :fill="color ? color : status.color"  />
        </svg>
      </v-list-item-icon>
    </template>
    <span v-text="hover ? (computedTask ? computedTask.title : 'Task') : 'Open'"></span>
  </v-tooltip>
</template>

<script>

import { getStatusTypeByValue } from '../../enums/taskstate';
import { getFileType } from '../../fixtures/fileTypes';
import { iconTypes } from '../../fixtures/iconTypes';
import { isTaskDone } from '../../store/modules/task/task';

export default {
  name: 'TaskIcon',
  props: { task: Object, taskId: String, icon: String, size: Number, color: String, mute: Boolean, hover: Boolean, extraClass: String },
  data() {
    return {
      loadedTask: null,
    };
  },
  mounted() {
    if (!this.task && this.taskId) this.getTask(this.taskId);
  },
  computed: {
    computedTask() {
      return this.task || this.loadedTask;
    },
    status() {
      return getStatusTypeByValue(this.computedTask ? this.computedTask.status : 0);
    },
    completed() {
      return isTaskDone(this.computedTask);
    },
    type() {
      if (!this.computedTask) return 'taskbox';
      return this.computedTask.taskType;
    },
    getIcon(){
      if(this.icon)return this.icon;
      if (this.type == 'file') return this.fileIcon((this.computedTask.value && this.computedTask.value.file && this.computedTask.value.file.extension) || null);
      else if (this.type == 'taskbox')
        return this.completed
          ? 'm 21.454744,3.5828806 c -3.388512,0.020648 -7.180933,1.1428628 -9.560387,2.9916171 L 5.8900701,11.239299 c -1.353807,1.051862 -2.0227686,2.163343 -2.0450875,3.170943 l -0.028064,-0.03353 0.017924,22.531078 h 0.01481 c 0.051109,1.292273 1.1832952,2.397213 3.3338936,2.954193 L 23.379756,44.05664 c 3.889349,1.007297 9.575098,-0.166401 12.747704,-2.631406 l 6.003513,-4.664804 c 1.336503,-1.038416 1.955865,-2.13121 2.001428,-3.124162 l 0.0156,-7.74e-4 0.03508,-22.460128 -0.0054,0.0063 C 44.177101,9.8505477 43.03812,8.7077146 40.837524,8.1377851 L 24.641314,3.9431282 C 23.668977,3.6913041 22.584282,3.576034 21.454778,3.5829173 Z M 21.640477,5.55286 c 0.881148,-0.00535 1.72707,0.084231 2.485608,0.280683 l 5.868296,1.5161893 -13.91,10.7510777 -6.8307416,-1.782339 C 7.7561209,15.930631 6.890686,15.202106 6.6931847,14.333415 6.8401002,13.649554 7.350863,12.922022 8.2447385,12.227511 L 14.181317,7.8864302 c 1.856259,-1.442247 4.815718,-2.3174606 7.45916,-2.3335702 z m 9.365143,2.0588434 7.805645,2.2060601 c 1.49195,0.3863975 2.35794,1.1105085 2.559676,1.9749195 -0.143911,0.686899 -0.62491,1.454782 -1.550775,2.116041 l -5.907769,4.219363 c -2.612659,1.731361 -6.910614,2.838698 -9.944768,2.052888 l -6.872008,-1.818194 z m 10.545713,8.1531766 0.06203,17.224694 c -0.120663,0.834939 -0.474675,1.555448 -1.569488,2.406081 l -5.89401,4.282681 c -2.475011,1.922998 -7.036989,2.785578 -10.068823,1.99086 L 9.0960934,37.741273 C 7.6214911,37.358386 6.7587125,36.647266 6.5442135,35.795982 6.5332755,35.481773 6.5223775,35.167563 6.5114795,34.853354 l 0.062027,-16.726227 c 0.0016,-0.399866 0.7736586,0.308211 1.2303287,0.426483 l 15.5759408,3.94655 c 3.889348,1.007296 9.575098,-0.166401 12.747704,-2.631406 z m -12.155588,8.398329 c -1.02595,0 -1.85173,0.825782 -1.85173,1.85173 v 12.760178 c 0,1.02595 0.82578,1.852511 1.85173,1.852511 1.025949,0 1.85173,-0.826561 1.85173,-1.852511 V 26.014939 c 0,-1.025948 -0.825781,-1.85173 -1.85173,-1.85173 z m -8.340974,3.007211 c -0.08912,2.18e-4 -0.177472,0.03172 -0.246378,0.092 l -0.0015,-0.03977 -5.422647,3.846922 -1.812746,-2.43181 c -0.115953,-0.155094 -0.3404,-0.191874 -0.504457,-0.08264 l -1.404197,0.933272 c -0.168288,0.11217 -0.208794,0.334735 -0.09044,0.494315 l 3.03138,4.078486 c 0.11748,0.158308 0.346956,0.194247 0.511468,0.07953 l 7.1699,-4.990706 c 0.165966,-0.11536 0.202683,-0.338638 0.08109,-0.495874 l -1.051003,-1.359755 -0.01248,0.01325 c -0.02295,-0.03978 -0.05353,-0.0753 -0.09044,-0.103698 -0.0502,-0.02301 -0.104023,-0.03366 -0.157495,-0.03353 z'
          : 'm 21.267177,3.3952703 c -3.38851,0.02065 -7.18069,1.142795 -9.56014,2.991547 L 5.7027527,11.051649 c -1.3538099,1.051864 -2.0230331,2.163784 -2.0453531,3.171383 l -0.027905,-0.03359 0.018087,22.530925 h 0.014986 c 0.0511,1.292272 1.1830467,2.39736 3.3336466,2.95434 l 16.1964268,4.194577 c 3.88935,1.0073 9.574932,-0.166362 12.747543,-2.631363 l 6.00325,-4.664832 c 1.33649,-1.038416 1.955859,-2.131407 2.001428,-3.124359 l 0.01602,-5.16e-4 0.03462,-22.460127 -0.0052,0.0062 c -5e-4,-1.3311127 -1.139764,-2.4738117 -3.340364,-3.0437427 L 24.454063,3.7554553 c -0.97234,-0.251824 -2.056869,-0.367068 -3.186369,-0.360185 z m 0.186035,1.969907 c 0.88115,-0.0053 1.727097,0.08467 2.485637,0.281119 4.93042,1.198118 9.803471,2.604567 14.68489,3.984252 1.491951,0.3863977 2.358321,1.1101467 2.560053,1.9745557 -0.143912,0.686898 -0.624941,1.454894 -1.55081,2.116151 l -5.908167,4.219379 c -2.612671,1.731362 -6.910453,2.838916 -9.944613,2.053106 -0.77738,-0.207764 -1.555371,-0.412962 -2.333191,-0.619083 0.004,-0.04734 0.0062,-0.09478 0.0062,-0.143144 V 8.6833193 c 0,-0.958845 -0.771793,-1.730642 -1.730643,-1.730642 h -0.152963 c -0.95885,0 -1.73116,0.771797 -1.73116,1.730642 V 18.422261 C 14.915306,17.655109 11.990612,16.893951 9.0663718,16.130927 7.5688616,15.743087 6.7033045,15.014726 6.5058044,14.146036 6.6527146,13.462173 7.1637678,12.734732 8.0576478,12.04022 L 13.994236,7.6988843 c 1.85626,-1.442247 4.815536,-2.3176 7.458976,-2.333707 z m 19.91093,10.2122937 0.06201,17.22479 c -0.120661,0.834938 -0.474602,1.55542 -1.569413,2.406052 l -5.894213,4.282427 c -2.47501,1.923 -7.036807,2.785817 -10.068637,1.991093 L 8.9087587,37.553908 C 7.4341585,37.171022 6.5714764,36.45957 6.3569763,35.608289 c -0.0109,-0.314213 -0.022173,-0.628366 -0.033073,-0.942578 l 0.062529,-16.726109 c 0.002,-0.399867 0.7732289,0.308057 1.2298989,0.426332 l 15.5763097,3.946527 c 3.88935,1.007295 9.574932,-0.166359 12.747543,-2.631363 z m -12.155848,8.398455 c -1.025949,0 -1.851566,0.825619 -1.851566,1.851567 v 12.759944 c 0,1.025951 0.825617,1.852599 1.851566,1.852599 1.02595,0 1.852085,-0.826648 1.852085,-1.852599 V 25.827493 c 0,-1.025948 -0.826135,-1.851567 -1.852085,-1.851567 z m -7.628991,1.394745 c -0.20152,0.0064 -0.386423,0.104042 -0.518315,0.240814 l -5.056539,5.185214 -2.245341,-2.238624 c -0.292515,-0.290867 -0.774498,-0.294854 -1.071252,-0.0083 l -1.385962,1.336352 h -5.17e-4 c -0.304099,0.293886 -0.308574,0.791033 -0.0098,1.090372 v 5.18e-4 l 4.178556,4.177006 c 0.29668,0.296307 0.788889,0.295304 1.084172,-0.0026 l 7.034195,-7.081736 0.001,-5.19e-4 c 0.297537,-0.299961 0.292067,-0.797256 -0.0124,-1.090372 l -1.443323,-1.390097 -0.0052,-0.0057 c -0.151925,-0.134125 -0.3478,-0.218829 -0.54932,-0.212392 z m 0.02274,0.702284 c -0.0014,4.5e-5 0.01334,-0.0045 0.06046,0.03669 6.32e-4,5.63e-4 -1.39e-4,4.52e-4 5.17e-4,0.001 l 1.426786,1.375109 c 0.02805,0.02699 0.028,0.06019 5.17e-4,0.08785 v 5.16e-4 l -3.443718,3.481959 -1.403531,-1.491382 3.323311,-3.464388 5.17e-4,-5.19e-4 c 0.03094,-0.03209 0.03654,-0.02692 0.03514,-0.02687 z';
      else return iconTypes[this.type][0] || 'm32.588 13.54 3.5541 3.4281-17.399 17.518-10.335-10.332 3.4281-3.3055 6.9072 6.8868z';
    }
  },
  methods: {
    getTask(id) {
      this.$store.dispatch('task/FETCH_TASK', id).then((task) => {
        this.loadedTask = task;
      });
    },
    fileIcon(extension) {
      return getFileType(extension).info.icon;
    },
    openContent() {
      if (this.mute) return;
      if (this.type !== 'taskbox') this.$store.commit('taskbox/PREVIEW_TASK', { task: this.computedTask, savestack: true, hideIO: true });
      else this.$store.dispatch('taskbox/OPEN_TASKBOX', { id: this.computedTask.id, deeper: true, savestack: true });
    },
  },
};
</script>
